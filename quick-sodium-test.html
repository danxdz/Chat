<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Sodium Test</title>
    <script src="/sodium.js"></script>
</head>
<body>
    <h1>Quick Sodium Test</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(msg) {
            console.log(msg);
            output.innerHTML += msg + '<br>';
        }

        log('üîß Starting test...');
        log('window.sodium available: ' + (typeof window.sodium !== 'undefined'));
        
        if (window.sodium) {
            log('sodium.ready type: ' + typeof window.sodium.ready);
            log('sodium.ready value: ' + window.sodium.ready);
            
            if (window.sodium.ready && typeof window.sodium.ready.then === 'function') {
                log('Waiting for sodium.ready promise...');
                window.sodium.ready.then(() => {
                    log('‚úÖ Sodium ready promise resolved!');
                    log('crypto_pwhash available: ' + (typeof window.sodium.crypto_pwhash === 'function'));
                    log('to_hex available: ' + (typeof window.sodium.to_hex === 'function'));
                    
                    // Try to hash something
                    try {
                        const salt = new Uint8Array(16).fill(1); // Simple salt
                        const result = window.sodium.crypto_pwhash(
                            32, // output length
                            'test1234',
                            salt,
                            window.sodium.crypto_pwhash_OPSLIMIT_INTERACTIVE,
                            window.sodium.crypto_pwhash_MEMLIMIT_INTERACTIVE,
                            window.sodium.crypto_pwhash_ALG_ARGON2ID
                        );
                        const hex = window.sodium.to_hex(result);
                        log('‚úÖ PIN hashing test successful: ' + hex.substring(0, 16) + '...');
                    } catch (error) {
                        log('‚ùå PIN hashing test failed: ' + error.message);
                    }
                }).catch(error => {
                    log('‚ùå Sodium ready promise rejected: ' + error.message);
                });
            } else if (window.sodium.ready === true) {
                log('‚úÖ Sodium is already ready (synchronous)');
            } else {
                log('‚ö†Ô∏è Sodium ready is falsy: ' + window.sodium.ready);
            }
        } else {
            log('‚ùå window.sodium not available');
        }
    </script>
</body>
</html>